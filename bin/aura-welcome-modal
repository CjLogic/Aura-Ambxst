#!/bin/bash
# Display welcome modal for first-time users

gum style \
    --border-foreground "#27F5B4" \
    --foreground 14 \
    --border double \
    --align center \
    --width 100 \
    --margin "1 2" \
    --padding "1 4" <<'EOF'
    "ðŸŽ‰ CONGRATULATIONS! Your Aura installation is complete! ðŸŽ‰"

        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
       â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ
       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
       â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ
       â–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ

EOF

echo


run_ambxst_install() {
    local installer_cmd="curl -L get.axeni.de/ambxst | sh"

    echo
    gum style \
        --foreground 14 --align center --width 76 --margin "0 2" \
        "Executing Ambxst environment installer:" \
        "  ${installer_cmd}"
    echo

    if ! command -v curl &>/dev/null; then
        gum style \
            --foreground 9 --bold --align center \
            "ERROR: curl is required to download the Ambxst installer."
        return 1
    fi

    if bash -c 'set -o pipefail; curl -L get.axeni.de/ambxst | sh'; then
        gum style \
            --foreground 10 --bold --align center \
            "Ambxst environment installed successfully."
        return 0
    else
        gum style \
            --foreground 9 --bold --align center \
            "Ambxst installer reported an error."
        gum style \
            --foreground 243 --italic --align center \
            "Check the output above and consider rerunning: ${installer_cmd}"
        return 1
    fi
}

# Important setup instructions
gum style \
    --foreground 11 --border-foreground 11 --border rounded \
    --width 76 --margin "0 2" --padding "1 2" \
    "IMPORTANT: Setup Instructions"

echo

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    "You are currently in Aura Hyprland! The beautiful desktop" \
    "environment is ready, but you need to install the Ambxst components."

echo

# QuickShell environment option
gum style \
    --foreground 11 --border-foreground 14 --border rounded \
    --width 76 --margin "0 2" --padding "1 2" \
    "Optional: Ambxst Environment"

echo

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    "Install the Ambxst environment immediately so your" \
    "preferred tools are ready right after restart."

echo

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    " It Takes 10-30 minutes depending on your system" \
    "If Install fails run the command below and try again"

echo

gum style \
    --foreground 14 --background 236 --padding "0 2" --margin "0 2" \
    "sudo pacman -Syyu"

echo

gum style \
    --foreground 14 --background 236 --padding "0 2" --margin "0 2" \
    "Command: curl -L get.axeni.de/ambxst | sh"

echo

if gum confirm "Install Ambxst environment now?" \
    --affirmative "Yes, run QuickShell" \
    --negative "No, maybe later" \
    --selected.background "#27F5B4" \
    --selected.foreground "#000000"; then
    gum style \
        --foreground 10 --bold --align center \
        "Starting  Ambxst installation..."
    echo
    sleep 1
    run_ambxst_install
else
    gum style \
        --foreground 14 --background 236 --padding "0 2" --margin "0 2" \
        "You can run Modal later with: aura-welcome-modal"
fi

echo

# Support
gum style \
    --foreground 247 --width 76 --margin "0 2" \
    "Support & Documentation:" \
    "  Aura: https://github.com/CjLogic/Aura" \
    "  Ambxst: https://axeni.de/ambxst" \
    "  Arch Wiki: https://wiki.archlinux.org"

echo

gum style \
    --foreground "#CEFDEE" --bold --align center \
    "Enjoy your beautiful new desktop environment! âœ¨"

echo

gum style \
    --foreground 8 --italic --align center \
    "Press any key to close this window..."

read -n 1 -s

# Mark welcome as shown
mkdir -p ~/.local/state/aura
touch ~/.local/state/aura/welcome-shown
